# Milestone v3.0: Multi-Account Support

**Status:** SHIPPED 2026-02-10
**Phases:** 11
**Total Plans:** 4

## Overview

Allow users to log into multiple Gmail accounts simultaneously, switch between them, and target specific accounts per-command. gh-style approach — single accounts manifest + per-account token files, explicit `switch` command, per-command `--account` flag override.

## Phases

### Phase 11: Multi-Account Support

**Goal**: Multi-account login, storage, migration, CLI commands, and full integration
**Depends on**: Phase 10 (Simplify CLI)
**Plans**: 4 plans

Plans:

- [x] 11-01: Account store and per-account token storage
- [x] 11-02: Migration logic and updated auth API
- [x] 11-03: CLI commands and account flag
- [x] 11-04: Wire --account flag to all commands

**Details:**

**Storage Layout:**
```
~/.config/gsuite/
├── accounts.json                # manifest: list of accounts + active
├── tokens/
│   ├── user1@gmail.com.json     # per-account OAuth2 token
│   └── user2@gmail.com.json
└── token.json                   # legacy (migrated on first run)
```

**Account Resolution Order:**
1. `--account user@gmail.com` flag (explicit per-command override)
2. `GSUITE_ACCOUNT` env var
3. `active` field in `accounts.json`
4. If only one account exists, use it
5. Error: "Multiple accounts found. Use --account or run `gsuite accounts switch`"

**New Commands:**
- `gsuite login` — Login and add a new account (or re-auth existing)
- `gsuite logout` — Remove active account, or `gsuite logout <email>` for specific
- `gsuite accounts list` — List all accounts, `*` marks active
- `gsuite accounts switch <email>` — Set a different active account
- `gsuite accounts remove <email>` — Remove specific account + token

**New Global Flag:**
- `--account <email>` — Use specific account for this command

---

## Milestone Summary

**Key Decisions:**
- Per-account token files (simpler file locking, easier to debug)
- Email as identifier (unique, discoverable, no profile naming)
- accounts.json manifest (single source of truth for active account)
- --account flag not --profile (Gmail-specific, clearer intent)
- Auto-migration (existing users don't need to do anything)
- Legacy functions renamed not deleted (preserve compat during migration)
- NewGmailService signature changed to accept account parameter (breaking change, callers updated in 11-03)

**Issues Resolved:**
- Plan 11-02 changed NewGmailService signature without updating callers — auto-fixed in 11-03
- Legacy token function renames required immediate caller updates — auto-fixed in 11-01

**Issues Deferred:**
None

**Technical Debt Incurred:**
None

---

_For current project status, see .planning/ROADMAP.md_
