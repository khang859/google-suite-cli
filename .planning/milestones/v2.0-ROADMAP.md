# Milestone v2.0: Auth Simplification

**Status:** ✅ SHIPPED 2026-02-07
**Phases:** 9-10
**Total Plans:** 2

## Overview

Strip the CLI down to OAuth2 PKCE-only authentication. Removed service account JWT auth, device authorization flow, credential type dispatching, and legacy CLI flags. The result is a simpler codebase with a single auth path — `auth.NewGmailService(ctx)` with no config struct.

## Phases

### Phase 9: Remove Auth Code

**Goal**: Strip auth package to OAuth2 PKCE-only — remove service account, device flow, and credential dispatching
**Depends on**: Phase 8
**Plans**: 1 plan

Plans:
- [x] 09-01: Strip auth to OAuth2-only (remove service account JWT, device flow, credential type detection)

**Details:**
- Removed all service account code (credentialType enum, detectCredentialType, newServiceAccountGmailService, JWTConfig usage)
- Removed DeviceAuthenticate() method from oauth2.go
- Simplified Login() to single PKCE browser flow (removed noBrowser parameter)
- Simplified NewGmailService() to direct OAuth2 token path (removed credential type dispatch)
- Removed --no-browser flag from login command
- 3 files modified: internal/auth/auth.go, internal/auth/oauth2.go, cmd/login.go

### Phase 10: Simplify CLI

**Goal**: Remove Config struct and legacy flags, simplify all subcommands to use auth.NewGmailService(ctx)
**Depends on**: Phase 9
**Plans**: 1 plan

Plans:
- [x] 10-01: Simplify CLI (remove Config struct, --credentials-file, --user flags, update all subcommands)

**Details:**
- Removed auth.Config struct entirely from internal/auth package
- Removed --credentials-file and --user persistent flags from root command
- Updated all 8 subcommand files to use simplified auth.NewGmailService(ctx) API
- Updated help text across login, whoami, and root commands to reflect OAuth2-only flow
- Net -349 lines removed
- 10 files modified: internal/auth/auth.go, cmd/root.go, cmd/login.go, cmd/whoami.go, cmd/messages.go, cmd/threads.go, cmd/labels.go, cmd/drafts.go, cmd/search.go, cmd/send.go

---

## Milestone Summary

**Key Decisions:**
- Removed Config struct entirely rather than simplifying — no subcommand needs to pass credentials since auth is always OAuth2 PKCE via env vars
- Kept UserEmail in Config during Phase 9 to avoid touching all subcommands — Phase 10 cleaned it up

**Issues Resolved:**
- None — clean two-phase execution

**Issues Deferred:**
- None

**Technical Debt Incurred:**
- None identified — this milestone was specifically about reducing technical debt

---

_For current project status, see .planning/ROADMAP.md_
