---
phase: 02-core-read-operations
plan: 02
type: execute
depends_on: []
files_modified: [cmd/search.go, cmd/labels.go]
---

<objective>
Implement search and labels list commands for Gmail.

Purpose: Enable users to search messages with Gmail query syntax and view available labels.
Output: Working `gsuite search` and `gsuite labels list` commands.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
@internal/auth/auth.go
@cmd/whoami.go
@cmd/root.go

**Tech stack available:** Go, Cobra CLI, google.golang.org/api/gmail/v1
**Established patterns:** Cobra command in cmd/, auth via auth.NewGmailService(), getter functions from root.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create search command</name>
  <files>cmd/search.go</files>
  <action>
Create cmd/search.go with `searchCmd` cobra command:

- Require search query as positional argument (Gmail query syntax)
- Get credentials and user from root flags
- Create Gmail service via auth.NewGmailService()
- Call service.Users.Messages.List("me").Q(query) with flags:
  - --max-results/-n (default 10, max 500)
  - --label-ids (optional, comma-separated filter)
- For each result, fetch full message via Messages.Get() and display:
  - Message ID, Date, From, Subject, Snippet (first 100 chars)
- Handle empty results gracefully ("No messages found matching query")

Use same error handling pattern as whoami.go.
Register command in init().
  </action>
  <verify>
go build -o gsuite . && ./gsuite search --help && go vet ./...
  </verify>
  <done>
- `gsuite search --help` shows usage with query argument and flags
- Search command compiles without errors
- go vet passes
  </done>
</task>

<task type="auto">
  <name>Task 2: Create labels list command</name>
  <files>cmd/labels.go</files>
  <action>
Create cmd/labels.go with:

1. Parent `labelsCmd` cobra command at "labels" for grouping
2. `labelsListCmd` subcommand at "list":
   - Get credentials and user from root flags
   - Create Gmail service via auth.NewGmailService()
   - Call service.Users.Labels.List("me").Do()
   - Print each label: ID, Name, Type (system/user)
   - Sort output: system labels first, then user labels alphabetically

Use same error handling pattern as whoami.go.
Register commands in init().
  </action>
  <verify>
go build -o gsuite . && ./gsuite labels --help && ./gsuite labels list --help && go vet ./...
  </verify>
  <done>
- `gsuite labels list --help` shows command usage
- Labels command compiles without errors
- go vet passes
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build -o gsuite .` succeeds
- [ ] `./gsuite search --help` shows query argument and flags
- [ ] `./gsuite labels list --help` shows command usage
- [ ] `go vet ./...` passes
</verification>

<success_criteria>

- Search command implemented with Gmail query support
- Labels list command implemented with sorted output
- Same auth pattern as existing commands
- No build or vet errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-read-operations/02-02-SUMMARY.md`
</output>
