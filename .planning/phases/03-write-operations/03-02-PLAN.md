---
phase: 03-write-operations
plan: 02
type: execute
depends_on: []
files_modified: [cmd/drafts.go]
---

<objective>
Implement draft management commands for creating, updating, listing, getting, sending, and deleting email drafts.

Purpose: Enable users to manage email drafts via CLI for staged email workflows.
Output: Working `gsuite drafts` command group with create, list, get, update, send, and delete subcommands.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Established patterns from Phase 1-2:**
- Auth: `auth.NewGmailService(ctx, cfg)` with GetCredentialsFile()/GetUserEmail() helpers
- Cobra: Parent command with subcommands (messages.go pattern)
- Output: Tabular for lists, detailed for single items
- Body extraction: base64url encoding/decoding patterns from messages.go

@cmd/messages.go (reference for list/get patterns, base64 decoding)
@cmd/labels.go (reference for parent + subcommand structure)
@internal/auth/auth.go (auth.Config, NewGmailService)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create drafts command group with list and get subcommands</name>
  <files>cmd/drafts.go</files>
  <action>
Create `gsuite drafts` parent command with `list` and `get` subcommands.

**drafts list:**
- Flags: `--max-results` / `-n` (default 10, max 500)
- Call `service.Users.Drafts.List("me").MaxResults(n).Do()`
- Display: Draft ID, Message ID, Subject (from headers), Snippet (truncated to 60 chars)

**drafts get <draft-id>:**
- Args: Draft ID (required)
- Call `service.Users.Drafts.Get("me", draftID).Format("full").Do()`
- Display: To, Subject, Date headers + body content (reuse extractBody pattern from messages.go)

Follow existing patterns:
- Parent command with Use: "drafts", Short: "Manage Gmail drafts"
- Subcommands with Use: "list", Use: "get <draft-id>"
- Standard auth setup (GetCredentialsFile, GetUserEmail, auth.Config)
- Error handling for missing user, auth failure, API errors
  </action>
  <verify>`go build -o gsuite .` succeeds, `./gsuite drafts --help` shows subcommands</verify>
  <done>drafts list and get commands work, display draft information correctly</done>
</task>

<task type="auto">
  <name>Task 2: Add drafts create, update, send, and delete subcommands</name>
  <files>cmd/drafts.go</files>
  <action>
Add remaining draft operations.

**drafts create:**
- Flags: `--to`, `--subject`, `--body` (all required), `--cc`, `--bcc` (optional)
- Build RFC 2822 message (same format as send command)
- Base64url encode: `base64.URLEncoding.EncodeToString([]byte(message))`
- Call `service.Users.Drafts.Create("me", &gmail.Draft{Message: &gmail.Message{Raw: encoded}}).Do()`
- Print: "Draft created: <draft-id>"

**drafts update <draft-id>:**
- Args: Draft ID (required)
- Flags: `--to`, `--subject`, `--body` (at least one required), `--cc`, `--bcc`
- Get existing draft first to preserve unmodified fields
- Build updated RFC 2822 message
- Call `service.Users.Drafts.Update("me", draftID, &gmail.Draft{Message: &gmail.Message{Raw: encoded}}).Do()`
- Print: "Draft updated: <draft-id>"

**drafts send <draft-id>:**
- Args: Draft ID (required)
- Call `service.Users.Drafts.Send("me", &gmail.Draft{Id: draftID}).Do()`
- Print: "Draft sent as message: <message-id>"

**drafts delete <draft-id>:**
- Args: Draft ID (required)
- Call `service.Users.Drafts.Delete("me", draftID).Do()`
- Print: "Draft deleted: <draft-id>"

Error handling:
- Missing required flags → clear error listing what's needed
- Draft not found → "draft not found: <draft-id>"
- API errors → "Gmail API error: <details>"
  </action>
  <verify>`./gsuite drafts --help` shows all 6 subcommands (list, get, create, update, send, delete)</verify>
  <done>All draft operations implemented, each with appropriate flags and output</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build -o gsuite .` succeeds without errors
- [ ] `./gsuite drafts --help` lists all subcommands
- [ ] `./gsuite drafts list --help` shows --max-results flag
- [ ] `./gsuite drafts create --help` shows --to, --subject, --body flags
- [ ] Code follows existing patterns from messages.go and labels.go
</verification>

<success_criteria>

- drafts command group with 6 subcommands (list, get, create, update, send, delete)
- Follows established auth, error handling, and output patterns
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-write-operations/03-02-SUMMARY.md`
</output>
