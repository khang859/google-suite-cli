---
phase: 03-write-operations
plan: 01
type: execute
depends_on: []
files_modified: [cmd/send.go]
---

<objective>
Implement the send message command for composing and sending emails via Gmail API.

Purpose: Enable users to send emails from the CLI, completing the first write operation capability.
Output: Working `gsuite send` command that sends plain text emails with To, Subject, and Body.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Established patterns from Phase 1-2:**
- Auth: `auth.NewGmailService(ctx, cfg)` with GetCredentialsFile()/GetUserEmail() helpers
- Cobra: Parent command + subcommands pattern (see messages.go, labels.go)
- Error handling: Validate --user flag, check credentials, wrap API errors

@cmd/messages.go (reference for patterns)
@internal/auth/auth.go (auth.Config, NewGmailService)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create send command with basic email composition</name>
  <files>cmd/send.go</files>
  <action>
Create `gsuite send` command that sends plain text emails.

Flags:
- `--to` / `-t` (required): Recipient email address
- `--subject` / `-s` (required): Email subject
- `--body` / `-b` (required): Plain text body content
- `--cc`: Optional CC recipients (comma-separated)
- `--bcc`: Optional BCC recipients (comma-separated)

Implementation:
1. Follow existing cmd/*.go patterns (GetCredentialsFile, GetUserEmail, auth.Config)
2. Build RFC 2822 formatted message with headers (To, Subject, Cc, Bcc)
3. Base64url encode the message (use `encoding/base64.URLEncoding.EncodeToString`)
4. Call `service.Users.Messages.Send("me", &gmail.Message{Raw: encodedMsg}).Do()`
5. Print success message with sent message ID

RFC 2822 format:
```
To: recipient@example.com
Cc: cc@example.com
Subject: Subject line

Body text here
```

Error handling:
- Missing required flags → clear error message
- Missing --user → "user flag required"
- Auth failure → "authentication failed: <details>"
- API error → "failed to send message: <details>"
  </action>
  <verify>Build succeeds: `go build -o gsuite .`</verify>
  <done>send command exists with --to, --subject, --body flags, validates required flags</done>
</task>

<task type="auto">
  <name>Task 2: Test send command structure and help</name>
  <files>cmd/send.go</files>
  <action>
Verify command is properly registered and help text is clear.

Check:
1. `gsuite send --help` shows usage with all flags
2. `gsuite send` without flags returns error listing required flags
3. Examples in help text show realistic usage

Add example usage to command:
```
gsuite send --to "recipient@example.com" --subject "Hello" --body "Message content"
gsuite send -t "user@domain.com" -s "Test" -b "Body text" --cc "cc@example.com"
```
  </action>
  <verify>`./gsuite send --help` shows all flags and examples</verify>
  <done>Help text displays correctly, missing flags produce clear error</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build -o gsuite .` succeeds without errors
- [ ] `./gsuite send --help` shows usage with all flags documented
- [ ] `./gsuite send` without args shows error about required flags
- [ ] Code follows existing patterns from messages.go
</verification>

<success_criteria>

- send command implemented with required flags (--to, --subject, --body)
- Optional --cc and --bcc flags supported
- Follows established auth and error handling patterns
- Build passes with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-write-operations/03-01-SUMMARY.md`
</output>
