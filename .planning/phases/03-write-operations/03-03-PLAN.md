---
phase: 03-write-operations
plan: 03
type: execute
depends_on: []
files_modified: [cmd/labels.go]
---

<objective>
Extend labels command group with create, update, delete operations, and add message label modification commands.

Purpose: Enable full label management and message labeling via CLI.
Output: Extended `gsuite labels` with create/update/delete, plus `gsuite messages modify` for label operations.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Established patterns from Phase 1-2:**
- Auth: `auth.NewGmailService(ctx, cfg)` with GetCredentialsFile()/GetUserEmail() helpers
- Labels list already exists in labels.go
- Messages command group exists in messages.go

@cmd/labels.go (extend this file - labels list already implemented)
@cmd/messages.go (add modify subcommand here)
@internal/auth/auth.go (auth.Config, NewGmailService)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add labels create, update, and delete subcommands</name>
  <files>cmd/labels.go</files>
  <action>
Extend existing labels.go with create, update, delete subcommands.

**labels create:**
- Flags: `--name` / `-n` (required): Label name
- Optional: `--label-list-visibility` (labelShow, labelShowIfUnread, labelHide), `--message-list-visibility` (show, hide)
- Call `service.Users.Labels.Create("me", &gmail.Label{Name: name, ...}).Do()`
- Print: "Label created: <label-id> (<label-name>)"

**labels update <label-id>:**
- Args: Label ID (required)
- Flags: `--name` (optional new name), `--label-list-visibility`, `--message-list-visibility`
- Note: Only user labels can be updated, not system labels
- Call `service.Users.Labels.Update("me", labelID, &gmail.Label{...}).Do()`
- Print: "Label updated: <label-id>"

**labels delete <label-id>:**
- Args: Label ID (required)
- Note: Only user labels can be deleted, not system labels
- Call `service.Users.Labels.Delete("me", labelID).Do()`
- Print: "Label deleted: <label-id>"

Error handling:
- Missing required args/flags → clear error
- System label modification attempt → "cannot modify/delete system label"
- Label not found → "label not found: <label-id>"
- API errors → "Gmail API error: <details>"

Register new subcommands in init() alongside existing labelsListCmd.
  </action>
  <verify>`./gsuite labels --help` shows list, create, update, delete subcommands</verify>
  <done>Labels CRUD complete with create, update, delete operations</done>
</task>

<task type="auto">
  <name>Task 2: Add messages modify command for label operations</name>
  <files>cmd/messages.go</files>
  <action>
Add `gsuite messages modify <message-id>` subcommand for adding/removing labels.

**messages modify <message-id>:**
- Args: Message ID (required)
- Flags:
  - `--add-labels`: Comma-separated label IDs to add
  - `--remove-labels`: Comma-separated label IDs to remove
- At least one of --add-labels or --remove-labels required
- Call `service.Users.Messages.Modify("me", messageID, &gmail.ModifyMessageRequest{AddLabelIds: [...], RemoveLabelIds: [...]}).Do()`
- Print: "Message modified: <message-id>"
- Show which labels were added/removed

Common use cases (add examples):
```
# Mark message as read (remove UNREAD label)
gsuite messages modify <id> --remove-labels UNREAD

# Archive message (remove INBOX label)
gsuite messages modify <id> --remove-labels INBOX

# Add custom label
gsuite messages modify <id> --add-labels Label_123

# Star a message
gsuite messages modify <id> --add-labels STARRED
```

Error handling:
- No label flags provided → "at least one of --add-labels or --remove-labels required"
- Message not found → "message not found: <message-id>"
- Invalid label ID → "label not found: <label-id>"
- API errors → "Gmail API error: <details>"

Register as subcommand under messagesCmd in init().
  </action>
  <verify>`./gsuite messages --help` shows list, get, modify subcommands</verify>
  <done>messages modify command works for adding/removing labels</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `go build -o gsuite .` succeeds without errors
- [ ] `./gsuite labels --help` shows list, create, update, delete
- [ ] `./gsuite messages --help` shows list, get, modify
- [ ] `./gsuite labels create --help` shows --name flag
- [ ] `./gsuite messages modify --help` shows --add-labels and --remove-labels flags
</verification>

<success_criteria>

- labels command extended with create, update, delete operations
- messages modify command implemented for label operations
- Follows established patterns and error handling
- Build passes with no errors
- Phase 3 complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-write-operations/03-03-SUMMARY.md`
</output>
